rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===== USER MANAGEMENT =====
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ===== COMPLAINTS MANAGEMENT =====
    match /complaints/{complaintId} {
      // Allow anyone to create complaints (for anonymous submissions)
      allow create: if true;
      
      // Allow public read access for admin dashboard
      allow read: if true;
      
      // Allow users to read their own complaints by email
      allow read: if request.auth != null && 
        resource.data.email == request.auth.token.email;
      
      // Only admins can update/delete complaints
      allow update, delete: if request.auth != null && isAdmin(request.auth.uid);
    }
    
    // ===== ANNOUNCEMENTS MANAGEMENT =====
    match /announcements/{announcementId} {
      // Allow public read access for announcements
      allow read: if true;
      
      // Allow authenticated users to create announcements
      allow create: if request.auth != null;
      
      // Only admins can update/delete announcements
      allow update, delete: if request.auth != null && isAdmin(request.auth.uid);
    }
    
    // ===== ANNOUNCEMENT REQUESTS =====
    match /announcementRequests/{requestId} {
      // Allow authenticated users to create requests
      allow create: if request.auth != null;
      
      // Only admins can read/write requests
      allow read, write: if request.auth != null && isAdmin(request.auth.uid);
    }
    
    // ===== HELPER FUNCTIONS =====
    
    // Check if user is admin (allows all authenticated users as admin for now)
    function isAdmin(uid) {
      return request.auth != null;
    }
  }
} 